---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Polyglot | Sylvia Xiao</title>
    
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/src/styles/page-backgrounds.css">
    
    <style>
      :root{ --fg:#1e2228; --muted:#5c6575; --line:#00000018; --link:#22c55e; --max:980px; --pad:22px; }
      @media (prefers-color-scheme: dark){ :root{ --fg:#e8e9ed; --muted:#a7abb7; --line:#ffffff22; --link:#4ade80; } }
      *{ box-sizing:border-box }
      body{ margin:0; color:var(--fg); font:16px/1.7 Inter, system-ui, sans-serif; }
      
      .navWrap{ position:sticky; top:0; z-index:40; backdrop-filter:saturate(120%) blur(6px);
        border-top:1px solid var(--line); border-bottom:1px solid var(--line);
        background:color-mix(in oklab,#ffffff 80%, transparent); }
      nav{ max-width:var(--max); margin:0 auto; padding:10px var(--pad); display:flex; flex-wrap:wrap; gap:16px }
      nav a{ color:var(--muted); text-decoration:none; display:inline-flex; gap:.45rem; align-items:center; position:relative }
      nav a:hover{ color:var(--fg) }
      nav a[href="/polyglot"]::after{ 
        content:""; position:absolute; left:0; right:0; bottom:-3px; height:2px;
        background:linear-gradient(90deg,#22c55e,#16a34a); transform:scaleX(1); transform-origin:left; transition:.25s; 
      }
      nav a:not([href="/polyglot"])::after{ 
        content:""; position:absolute; left:0; right:0; bottom:-3px; height:2px;
        background:linear-gradient(90deg,#3b82f6,#1d4ed8); transform:scaleX(0); transform-origin:left; transition:.25s; 
      }
      nav a:hover::after{ transform:scaleX(1); }
      .icon{ width:16px; height:16px; opacity:.9; }
      
      .page-container{ min-height: 100vh; padding: 2rem 0; }
      .page-content{ max-width: 980px; margin: 0 auto; padding: 2rem 22px; background: color-mix(in oklab, #ffffff 85%, transparent);
        border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); }
      .page-title{ font-family:"EB Garamond",serif; font-size:48px; margin:0 0 1rem; text-align:center; color:#22c55e; }
      .page-subtitle{ font-size:20px; color:var(--muted); text-align:center; margin-bottom:3rem; }
      
      /* 打卡热力图样式 */
      .heatmap-container {
        margin: 2rem 0;
        padding: 1.5rem;
        background: color-mix(in oklab, #ffffff 98%, transparent);
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      .heatmap-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 3px;
        margin: 1rem 0;
        padding: 1rem;
        background: color-mix(in oklab, #f8f9fa 50%, transparent);
        border-radius: 8px;
      }
      
      .heatmap-day {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
      }
      
      .heatmap-day:hover {
        transform: scale(1.2);
        z-index: 10;
      }
      
      .heatmap-day[data-level="0"] { background: #ebedf0; }
      .heatmap-day[data-level="1"] { background: #c6e48b; }
      .heatmap-day[data-level="2"] { background: #7bc96f; }
      .heatmap-day[data-level="3"] { background: #239a3b; }
      .heatmap-day[data-level="4"] { background: #196127; }
      
      .heatmap-legend {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-top: 1rem;
      }
      
      .legend-colors {
        display: flex;
        gap: 2px;
      }
      
      .legend-color {
        width: 10px;
        height: 10px;
        border-radius: 2px;
      }
      
      .legend-label {
        font-size: 12px;
        color: var(--muted);
      }
      
      /* 统计卡片样式 */
      .stats-container {
        margin: 2rem 0;
        padding: 1.5rem;
        background: color-mix(in oklab, #ffffff 98%, transparent);
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }
      
      .stat-card {
        text-align: center;
        padding: 1rem;
        background: color-mix(in oklab, #f8f9fa 30%, transparent);
        border-radius: 8px;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #22c55e;
        margin-bottom: 0.5rem;
      }
      
      .stat-label {
        font-size: 0.9rem;
        color: var(--muted);
      }
      
      /* 语言学习时间分布图表 */
      .language-chart {
        margin-top: 2rem;
      }
      
      .language-chart h5 {
        margin-bottom: 1rem;
        color: var(--fg);
      }
      
      .chart-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .chart-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      
      .bar-label {
        min-width: 80px;
        font-size: 0.9rem;
        color: var(--fg);
      }
      
      .bar-track {
        flex: 1;
        height: 20px;
        background: color-mix(in oklab, #f1f5f9 50%, transparent);
        border-radius: 10px;
        overflow: hidden;
        position: relative;
      }
      
      .bar-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.8s ease;
        position: relative;
      }
      
      .bar-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: shimmer 2s infinite;
      }
      
      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      
      .bar-value {
        min-width: 40px;
        text-align: right;
        font-weight: 600;
        color: var(--fg);
      }
      
      /* 深色模式适配 */
      @media (prefers-color-scheme: dark) {
        .heatmap-container, .stats-container {
          background: color-mix(in oklab, #1f2937 98%, transparent);
          border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .heatmap-grid {
          background: color-mix(in oklab, #374151 30%, transparent);
        }
        
        .stat-card {
          background: color-mix(in oklab, #374151 30%, transparent);
          border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .bar-track {
          background: color-mix(in oklab, #374151 50%, transparent);
        }
      }
      
      @media (max-width:768px){ 
        .page-title{ font-size:36px; } 
        .page-content{ padding:1rem; } 
        .stats-grid { grid-template-columns: repeat(2, 1fr); }
        .chart-bar { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
        .bar-track { width: 100%; }
      }
    </style>
  </head>

  <body class="polyglot-page">
    <svg width="0" height="0" style="position:absolute"><defs>
      <symbol id="ic-book" viewBox="0 0 24 24"><path fill="currentColor" d="M6 4h9a3 3 0 0 1 3 3v12.5a.5.5 0 0 1-.8.4l-2.2-1.6a2 2 0 0 0-1.2-.4H6A2 2 0 0 1 4 16V6a2 2 0 0 1 2-2Zm0 2v10h8a4 4 0 0 1 2 .6V7a1 1 0 0 0-1-1H6Z"/></symbol>
      <symbol id="ic-code" viewBox="0 0 24 24"><path fill="currentColor" d="M9.4 16.6 5.8 13l3.6-3.6 1.4 1.4L8.6 13l2.2 2.2-1.4 1.4Zm5.2 0-1.4-1.4L15.4 13l-2.2-2.2 1.4-1.4L18.2 13l-3.6 3.6Z"/></symbol>
      <symbol id="ic-feather" viewBox="0 0 24 24"><path fill="currentColor" d="M20.7 4.3a4.5 4.5 0 0 0-6.4 0L4 14.6V20h5.4L20.7 10.7a4.5 4.5 0 0 0 0-6.4ZM8.6 18H6v-2.6l7.7-7.7 2.6 2.6L8.6 18Z"/></symbol>
      <symbol id="ic-note" viewBox="0 0 24 24"><path fill="currentColor" d="M12 3v11.1a3.5 3.5 0 1 1-1.5-2.9V6.1l8-2V13a3.5 3.5 0 1 1-1.5-2.9V3.9L12 5.4V3Z"/></symbol>
      <symbol id="ic-chat" viewBox="0 0 24 24"><path fill="currentColor" d="M4 5h10a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3H8l-4 4V8a3 3 0 0 1 3-3Zm14 1h2a2 2 0 0 1 2 2v8l-3-3h-1V6Z"/></symbol>
      <symbol id="ic-archive" viewBox="0 0 24 24"><path fill="currentColor" d="M3 7h18v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7Zm2 0-1-2h16l-1 2H5Zm4 6h6v2H9v-2Z"/></symbol>
    </defs></svg>

    <div class="navWrap">
      <nav>
        <a href="/"><svg class="icon"><use href="#ic-book"/></svg>Home</a>
        <a href="/research"><svg class="icon"><use href="#ic-book"/></svg>Research</a>
        <a href="/tech"><svg class="icon"><use href="#ic-code"/></svg>Tech</a>
        <a href="/essays"><svg class="icon"><use href="#ic-feather"/></svg>Essays</a>
        <a href="/music"><svg class="icon"><use href="#ic-note"/></svg>Music</a>
        <a href="/polyglot"><svg class="icon"><use href="#ic-chat"/></svg>Polyglot</a>
        <a href="/reading"><svg class="icon"><use href="#ic-feather"/></svg>Reading</a>
        <a href="/archive"><svg class="icon"><use href="#ic-archive"/></svg>Archive</a>
      </nav>
    </div>

    <div class="page-container">
      <div class="page-content">
        <h1 class="page-title">Polyglot</h1>
        <p class="page-subtitle">Be a Polyglot · Public log of my language study (Cantonese, Japanese, German)</p>
        
        <div class="content-section">
          <h2>Learning Streaks</h2>
          <p>Daily learning progress tracking with heatmap visualization.</p>
          
          <div class="polyglot-highlight">
            <h4>Current Streaks</h4>
            <ul>
              <li><strong>Cantonese:</strong> 45 days (Daily conversation practice)</li>
              <li><strong>Japanese:</strong> 23 days (Kanji study + grammar)</li>
              <li><strong>German:</strong> 12 days (Reading + vocabulary)</li>
            </ul>
          </div>
          
          <!-- 打卡热力图 -->
          <div class="heatmap-container">
            <h4>Learning Heatmap - December 2024</h4>
            <div class="heatmap-grid" id="heatmapGrid">
              <!-- 热力图将通过JavaScript生成 -->
            </div>
            <div class="heatmap-legend">
              <span class="legend-label">Less</span>
              <div class="legend-colors">
                <div class="legend-color" style="background: #ebedf0;"></div>
                <div class="legend-color" style="background: #c6e48b;"></div>
                <div class="legend-color" style="background: #7bc96f;"></div>
                <div class="legend-color" style="background: #239a3b;"></div>
                <div class="legend-color" style="background: #196127;"></div>
              </div>
              <span class="legend-label">More</span>
            </div>
          </div>
          
          <!-- 年度统计图表 -->
          <div class="stats-container">
            <h4>2024 Learning Statistics</h4>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number" id="totalDays">127</div>
                <div class="stat-label">Total Learning Days</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="totalHours">89</div>
                <div class="stat-label">Total Hours</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="longestStreak">45</div>
                <div class="stat-label">Longest Streak</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="currentStreak">12</div>
                <div class="stat-label">Current Streak</div>
              </div>
            </div>
            
            <!-- 语言学习时间分布图表 -->
            <div class="language-chart">
              <h5>Time Distribution by Language</h5>
              <div class="chart-container">
                <div class="chart-bar">
                  <div class="bar-label">Cantonese</div>
                  <div class="bar-track">
                    <div class="bar-fill" style="width: 45%; background: linear-gradient(90deg, #22c55e, #16a34a);"></div>
                  </div>
                  <div class="bar-value">45h</div>
                </div>
                <div class="chart-bar">
                  <div class="bar-label">Japanese</div>
                  <div class="bar-track">
                    <div class="bar-fill" style="width: 30%; background: linear-gradient(90deg, #f59e0b, #d97706);"></div>
                  </div>
                  <div class="bar-value">30h</div>
                </div>
                <div class="chart-bar">
                  <div class="bar-label">German</div>
                  <div class="bar-track">
                    <div class="bar-fill" style="width: 14%; background: linear-gradient(90deg, #3b82f6, #1d4ed8);"></div>
                  </div>
                  <div class="bar-value">14h</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="content-section">
          <h2>Learning Logs</h2>
          <p>Vocabulary cards, example sentences, and pronunciation clips.</p>
          
          <div class="polyglot-highlight">
            <h4>Recent Vocabulary</h4>
            <p><strong>Cantonese:</strong> 唔該 (m4 goi1) - Thank you / Excuse me</p>
            <p><strong>Japanese:</strong> 頑張る (ganbaru) - To do one's best</p>
            <p><strong>German:</strong> sich freuen - To be happy about</p>
          </div>
          
          <div class="polyglot-highlight">
            <h4>Pronunciation Practice</h4>
            <p>Audio clips and phonetic notes for challenging sounds in each language.</p>
          </div>
        </div>
        
        <div class="content-section">
          <h2>Weekly Summaries</h2>
          <p>Reflections on learning progress, challenges, and insights.</p>
          
          <div class="polyglot-highlight">
            <h4>Week 12, 2024</h4>
            <p>Made significant progress in Cantonese tone recognition. The musical nature of the language is becoming more intuitive. Japanese grammar patterns are starting to click, especially the particle system. German compound words are fascinating - they're like linguistic puzzles!</p>
          </div>
          
          <div class="polyglot-highlight">
            <h4>Language Learning Insights</h4>
            <p>Cross-linguistic connections between Cantonese tones and musical pitch, Japanese politeness levels and social hierarchy, German compound formation and semantic composition.</p>
          </div>
        </div>
        
        <div class="content-section">
          <h2>Resources & Methods</h2>
          <p>Tools, techniques, and resources that have been most effective for language learning.</p>
          
          <div class="polyglot-highlight">
            <h4>Learning Tools</h4>
            <p>Anki flashcards, language exchange partners, immersion through media, and structured grammar study.</p>
          </div>
          
          <div class="polyglot-highlight">
            <h4>Cultural Immersion</h4>
            <p>Movies, music, literature, and conversations with native speakers to understand cultural context.</p>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      // 生成打卡热力图
      function generateHeatmap() {
        const grid = document.getElementById('heatmapGrid');
        if (!grid) return;
        
        // 模拟12月的数据 (1-31日)
        const decemberData = {
          1: 2, 2: 3, 3: 1, 4: 4, 5: 2, 6: 0, 7: 0,  // 第一周
          8: 3, 9: 4, 10: 2, 11: 3, 12: 4, 13: 1, 14: 0,  // 第二周
          15: 2, 16: 3, 17: 4, 18: 2, 19: 3, 20: 4, 21: 0,  // 第三周
          22: 1, 23: 3, 24: 4, 25: 2, 26: 3, 27: 4, 28: 0,  // 第四周
          29: 2, 30: 3, 31: 4  // 第五周
        };
        
        // 清空现有内容
        grid.innerHTML = '';
        
        // 添加星期标签
        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        weekdays.forEach(day => {
          const dayLabel = document.createElement('div');
          dayLabel.textContent = day;
          dayLabel.style.fontSize = '10px';
          dayLabel.style.color = 'var(--muted)';
          dayLabel.style.textAlign = 'center';
          dayLabel.style.marginBottom = '5px';
          grid.appendChild(dayLabel);
        });
        
        // 生成日期格子
        for (let day = 1; day <= 31; day++) {
          const dayElement = document.createElement('div');
          dayElement.className = 'heatmap-day';
          dayElement.setAttribute('data-level', decemberData[day] || 0);
          dayElement.setAttribute('data-day', day);
          dayElement.setAttribute('title', `December ${day}, 2024: ${decemberData[day] || 0} hours`);
          
          // 添加点击事件
          dayElement.addEventListener('click', function() {
            const currentLevel = parseInt(this.getAttribute('data-level'));
            const newLevel = (currentLevel + 1) % 5;
            this.setAttribute('data-level', newLevel);
            this.setAttribute('title', `December ${day}, 2024: ${newLevel} hours`);
            
            // 更新统计数据
            updateStats();
          });
          
          grid.appendChild(dayElement);
        }
      }
      
      // 更新统计数据
      function updateStats() {
        const days = document.querySelectorAll('.heatmap-day');
        let totalDays = 0;
        let totalHours = 0;
        let currentStreak = 0;
        let longestStreak = 0;
        let tempStreak = 0;
        
        // 从今天开始往前计算
        const today = new Date().getDate();
        
        days.forEach((day, index) => {
          const dayNum = parseInt(day.getAttribute('data-day'));
          const level = parseInt(day.getAttribute('data-level'));
          
          if (level > 0) {
            totalDays++;
            totalHours += level;
            
            if (dayNum <= today) {
              tempStreak++;
            } else {
              tempStreak = 0;
            }
          } else {
            if (dayNum <= today) {
              longestStreak = Math.max(longestStreak, tempStreak);
              tempStreak = 0;
            }
          }
        });
        
        currentStreak = tempStreak;
        longestStreak = Math.max(longestStreak, tempStreak);
        
        // 更新显示
        document.getElementById('totalDays').textContent = totalDays;
        document.getElementById('totalHours').textContent = totalHours;
        document.getElementById('longestStreak').textContent = longestStreak;
        document.getElementById('currentStreak').textContent = currentStreak;
      }
      
      // 页面加载完成后生成热力图
      document.addEventListener('DOMContentLoaded', function() {
        generateHeatmap();
        updateStats();
        
        // 添加动画效果
        setTimeout(() => {
          const bars = document.querySelectorAll('.bar-fill');
          bars.forEach((bar, index) => {
            setTimeout(() => {
              bar.style.width = bar.style.width;
            }, index * 200);
          });
        }, 500);
      });
    </script>
  </body>
</html>